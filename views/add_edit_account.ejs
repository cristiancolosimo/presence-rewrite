<!DOCTYPE html>
<html lang="it">
<head>
    <%- include('components/head_dashboard'); %>
    <%- include('components/style_dashboard'); %>

</head>
<body>
    <%- include('components/header'); %>

    <div class="container">
            <flex-column style="gap: 10px;">
                <card>
                    <% if(user) {%>
                    <card-title>Modifica utente <%= user.username %></card-title>
                    <% } else { %>
                    <card-title>Aggiungi utente</card-title>
                    <% } %>
                    <card-content>

                        <flex-column style="gap: 10px;">
                            <form action="" method="post">

                            <div>Username: <input minlength="5" maxlength="20" type="text" name="username" placeholder="Username" value="<%= user?.username || '' %>" <%= user !== undefined ? 'disabled' : ''%> <%= user == undefined ? 'required':'' %> ></div>
                            <div>Email:<input type="email" name="email" placeholder="Email" value="<%= user?.email || '' %>" <%= user == undefined ? 'required':'' %>></div>
                            <div>Password:<input minlength="10" maxlength="100" type="password" name="password" placeholder="Password" <%= user == undefined ? 'required':'' %>></div>
                            <div>
                                Stato : <select name="enabled">
                                <option value="true" <% if(user?.enabled == true) { %> selected <% } %>>Abilitato</option>
                                <option value="false" <% if(user?.enabled == false) { %> selected <% } %>>Disabilitato</option>
                            </select> 
                        </div>
                            <div>
                                <p>Permessi</p>
                                <flex-column style="gap: 10px;">
                                    <div><input type="checkbox" name="permission_admin" <% if(permission?.includes("super-admin")) { %> checked <% } %>>Admin</div>
                                    <div><input type="checkbox" name="permission_internal_door" <% if(permission?.includes("unlock-internal-door")) { %> checked <% } %>> Apertura porta interna</div>
                                    <div><input type="checkbox" name="permission_external_door" <% if(permission?.includes("unlock-external-door")) { %> checked <% } %>> Apertura porta esterna</div>
                                </flex-column>
                            </div>
                            <% if(user) {%>
                            <button type="submit">Modifica</button>
                            <% } else { %>
                            <button type="submit">Aggiungi</button>
                            <% } %>
                        </form>

                        </flex-column>
                    </card-content>
                </card>
                <% if(user && !currentUser) {%>
                <card>
                    <card-title>Elimina utente</card-title>
                    <card-content>
                        <flex-wrap style="gap: 10px;">
                            <form action="/accounts/administration/user/delete/<%= user.id %>" method="post">
                                <flex-column>
                            <p>Sei sicuro di voler eliminare l'utente <strong><%= user.username %></strong>?</p>
                            <div><input type="checkbox" name="confirm" value="true" required></checkbox> Confermi</div>
                            <button type="submit"value="true">Elimina</button>
                        </flex-column>
                        </form>
                        </flex-wrap>
                    </card-content>
                </card>
                <% } %>
            </flex-column>
    </div>
</body>
</html>